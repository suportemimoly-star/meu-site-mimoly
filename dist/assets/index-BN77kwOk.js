import{initializeApp as D}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";import{getAuth as T,GoogleAuthProvider as P,createUserWithEmailAndPassword as S,updateProfile as O,signInWithPopup as R}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";import{getFirestore as N,setDoc as B,doc as b,serverTimestamp as p,getDoc as q,updateDoc as F}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";import{getStorage as U}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";import{getFunctions as z}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-functions.js";import{initializeAppCheck as V,ReCaptchaV3Provider as j}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-app-check.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))f(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const c of t.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&f(c)}).observe(document,{childList:!0,subtree:!0});function i(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function f(e){if(e.ep)return;e.ep=!0;const t=i(e);fetch(e.href,t)}})();const K={apiKey:"AIzaSyAkcwuCBTC0uRqcDqb1OVnAD1w2ioonfBI",authDomain:"mimoly-dev.firebaseapp.com",projectId:"mimoly-dev",storageBucket:"mimoly-dev.firebasestorage.app",messagingSenderId:"99362411943",appId:"1:99362411943:web:176a9b6ea46c20813b9282",measurementId:void 0},g=D(K);V(g,{provider:new j("6Lf3EdcrAAAAAB3gfwxQ6A5zYoxjKMVr6EC27-R1"),isTokenAutoRefreshEnabled:!0});const C=T(g),I=N(g);U(g);z(g,"us-central1");document.addEventListener("DOMContentLoaded",()=>{const y=new P;y.setCustomParameters({prompt:"select_account"});const n=document.getElementById("message-box"),i=(o,r=!1)=>{n.textContent=o,n.style.backgroundColor=r?"#ef4444":"#22c55e",n.classList.add("show"),setTimeout(()=>{n.classList.remove("show")},3e3)},f=async o=>{const r=o.currentTarget,E=r.querySelector("span").textContent;r.disabled=!0,r.querySelector("span").textContent="Carregando...";try{const d=await R(C,y),{user:s}=d,l=b(I,"users",s.uid),m=await q(l);m.exists()?(await F(l,{lastLogin:p()}),m.data().profileComplete?window.location.href="/app.html":window.location.href="/perfil.html?msg=complete-profile"):(await B(l,{uid:s.uid,displayName:s.displayName,email:s.email,photoURL:s.photoURL||"",curtidas:0,saldoMimos:0,saldoReais:0,createdAt:p(),lastLogin:p(),profileComplete:!1}),window.location.href="/perfil.html?msg=complete-profile")}catch(d){i(d.code==="auth/popup-closed-by-user"?"O pop-up de login foi fechado.":"Ocorreu um erro.",!0),r.disabled=!1,r.querySelector("span").textContent=E}};document.getElementById("google-login-btn-1").addEventListener("click",f);const e=document.getElementById("signup-modal"),t=document.getElementById("open-signup-modal-btn"),c=document.getElementById("close-signup-modal"),v=document.getElementById("terms-modal"),A=document.getElementById("close-terms-modal"),x=document.getElementById("close-terms-modal-2"),M=document.getElementById("open-terms-modal-main"),k=document.getElementById("open-terms-modal-from-signup");function w(o){o.preventDefault(),v.classList.remove("hidden")}function L(){v.classList.add("hidden")}M.addEventListener("click",w),k.addEventListener("click",w),A.addEventListener("click",L),x.addEventListener("click",L),t.addEventListener("click",o=>{o.preventDefault(),e.classList.add("show")}),c.addEventListener("click",()=>{e.classList.remove("show")}),e.addEventListener("click",o=>{o.target===e&&e.classList.remove("show")}),document.getElementById("signup-form").addEventListener("submit",async o=>{if(o.preventDefault(),!document.getElementById("signup-terms-agree").checked){i("Você precisa aceitar os Termos de Serviço para continuar.",!0);return}const E=document.getElementById("signup-name").value.trim(),d=document.getElementById("signup-email").value.trim(),s=document.getElementById("signup-password").value,l=document.getElementById("signup-confirm-password").value,m=E.toUpperCase().slice(0,15);if(s.length<6||s!==l){i(s.length<6?"A senha deve ter no mínimo 6 caracteres.":"As senhas não coincidem.",!0);return}const u=document.getElementById("signup-btn");u.disabled=!0,u.textContent="Cadastrando...";try{const h=await S(C,d,s),{user:a}=h;await O(a,{displayName:m}),await B(b(I,"users",a.uid),{uid:a.uid,displayName:m,email:a.email,photoURL:"",curtidas:0,saldoMimos:0,saldoReais:0,createdAt:p(),lastLogin:p(),profileComplete:!1}),window.location.href="/perfil.html?msg=complete-profile"}catch(h){console.error("Erro no cadastro:",h);let a="Erro ao criar a conta.";h.code==="auth/email-already-in-use"&&(a="Este e-mail já está em uso."),i(a,!0)}finally{u.disabled=!1,u.textContent="Cadastrar"}})});
